<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cms.mapper.CmsCustomerCostMapper">
  <resultMap id="BaseResultMap" type="com.cms.pojo.CmsCustomerCost">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="cms_cc_id" jdbcType="INTEGER" property="cmsCcId" />
    <result column="cms_cc_rid" jdbcType="INTEGER" property="cmsCcRid" />
    <result column="balance" jdbcType="REAL" property="balance" />
    <result column="overdraft" jdbcType="REAL" property="overdraft" />
    <result column="cms_cc_rank_id" jdbcType="INTEGER" property="cmsCcRankId" />
    <result column="customer_type" jdbcType="VARCHAR" property="customerType" />
    <result column="version" jdbcType="INTEGER" property="version" />
    <result column="cms_cc_creator" jdbcType="INTEGER" property="cmsCcCreator" />
    <result column="cms_cc_updator" jdbcType="INTEGER" property="cmsCcUpdator" />
    <result column="cms_cc_creat_time" jdbcType="TIMESTAMP" property="cmsCcCreatTime" />
    <result column="cms_cc_update_time" jdbcType="TIMESTAMP" property="cmsCcUpdateTime" />
    <result column="delete_sign" jdbcType="VARCHAR" property="deleteSign" />
    <result column="cms_cc_plan_id" property="cmsCcPlanId"/>
  </resultMap>
  <resultMap id="JoinResultMap" type="com.cms.pojo.CmsCustomerCost">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
      <id column="cms_cc_id" jdbcType="INTEGER" property="cmsCcId" />
    <result column="cms_cc_rid" jdbcType="INTEGER" property="cmsCcRid" />
    <result column="balance" jdbcType="REAL" property="balance" />
    <result column="overdraft" jdbcType="REAL" property="overdraft" />
    <result column="cms_cc_rank_id" jdbcType="INTEGER" property="cmsCcRankId" />
    <result column="customer_type" jdbcType="VARCHAR" property="customerType" />
    <result column="c_version" jdbcType="INTEGER" property="version" />
    <result column="cms_cc_creator" jdbcType="INTEGER" property="cmsCcCreator" />
    <result column="cms_cc_updator" jdbcType="INTEGER" property="cmsCcUpdator" />
    <result column="cms_cc_creat_time" jdbcType="TIMESTAMP" property="cmsCcCreatTime" />
    <result column="cms_cc_update_time" jdbcType="TIMESTAMP" property="cmsCcUpdateTime" />
    <result column="c_delete_sign" jdbcType="VARCHAR" property="deleteSign" />
    <result column="cms_cc_plan_id" property="cmsCcPlanId"/>
    <association property="cmsPlan" javaType="com.cms.pojo.CmsPlan">
		  <id column="cms_plan_id" jdbcType="INTEGER" property="cmsPlanId" />
		<result column="cms_plan_rid" jdbcType="INTEGER" property="cmsPlanRid" />
		<result column="plan_version" jdbcType="INTEGER" property="planVersion" />
		<result column="plan_name" jdbcType="VARCHAR" property="planName" />
		<result column="plan_info" jdbcType="VARCHAR" property="planInfo" />
		<result column="plan_money" jdbcType="REAL" property="planMoney" />
		<result column="call_duration" jdbcType="INTEGER" property="callDuration" />
		<result column="msg_number" jdbcType="INTEGER" property="msgNumber" />
		<result column="nationwide_flow" jdbcType="INTEGER" property="nationwideFlow" />
		<result column="province_flow" jdbcType="INTEGER" property="provinceFlow" />
		<result column="p_version" jdbcType="INTEGER" property="version" />
		<result column="cms_cp_creator" jdbcType="INTEGER" property="cmsCpCreator" />
		<result column="cms_cp_updator" jdbcType="INTEGER" property="cmsCpUpdator" />
		<result column="cms_cp_creat_time" jdbcType="TIMESTAMP" property="cmsCpCreatTime" />
		<result column="cms_cp_update_time" jdbcType="TIMESTAMP" property="cmsCpUpdateTime" />
		<result column="p_delete_sign" jdbcType="VARCHAR" property="deleteSign" />
	</association>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    cms_cc_id, cms_cc_rid, balance, overdraft, cms_cc_plan_id, cms_cc_rank_id, customer_type, 
    version, cms_cc_creator, cms_cc_updator, cms_cc_creat_time, cms_cc_update_time, delete_sign
  </sql>
  <sql id="join_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    cms_cc_id, cms_cc_rid, balance, overdraft, cms_customer_cost.cms_cc_plan_id, cms_cc_rank_id, customer_type, 
    cms_customer_cost.version, cms_cc_creator, cms_cc_updator, cms_cc_creat_time, cms_cc_update_time, delete_sign,cms_plan.cms_plan_id,plan_money,cms_plan.version
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from cms_customer_cost
    where cms_cc_id = #{cmsCcId,jdbcType=INTEGER}
  </select>
  <select id="selectBybalance"  resultMap="JoinResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
   SELECT 
        cms_cc_id, cms_cc_rid, balance, overdraft, cms_cc_plan_id, cms_cc_rank_id, customer_type, 
    ccc.version c_version , cms_cc_creator, cms_cc_updator, cms_cc_creat_time, cms_cc_update_time, ccc.delete_sign c_delete_sign
	,cms_plan_id,plan_money,cp.version p_version,cp.delete_sign p_delete_sign

    FROM cms_customer_cost ccc JOIN cms_plan cp
    ON ccc.cms_cc_plan_id = cp.cms_plan_id
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from cms_customer_cost
    where cms_cc_id = #{cmsCcId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.cms.pojo.CmsCustomerCost">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into cms_customer_cost (cms_cc_id, cms_cc_rid, balance, 
      overdraft, cms_cc_plan_id, cms_cc_rank_id, 
      customer_type, version, cms_cc_creator, 
      cms_cc_updator, cms_cc_creat_time, cms_cc_update_time, 
      delete_sign)
    values (#{cmsCcId,jdbcType=INTEGER}, #{cmsCcRid,jdbcType=INTEGER}, #{balance,jdbcType=REAL}, 
      #{overdraft,jdbcType=REAL}, #{cmsCcPlanId,jdbcType=INTEGER}, #{cmsCcRankId,jdbcType=INTEGER}, 
      #{customerType,jdbcType=VARCHAR}, #{version,jdbcType=INTEGER}, #{cmsCcCreator,jdbcType=INTEGER}, 
      #{cmsCcUpdator,jdbcType=INTEGER}, #{cmsCcCreatTime,jdbcType=TIMESTAMP}, #{cmsCcUpdateTime,jdbcType=TIMESTAMP}, 
      #{deleteSign,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.cms.pojo.CmsCustomerCost">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into cms_customer_cost
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="cmsCcId != null">
        cms_cc_id,
      </if>
      <if test="cmsCcRid != null">
        cms_cc_rid,
      </if>
      <if test="balance != null">
        balance,
      </if>
      <if test="overdraft != null">
        overdraft,
      </if>
      <if test="cmsCcPlanId != null">
        cms_cc_plan_id,
      </if>
      <if test="cmsCcRankId != null">
        cms_cc_rank_id,
      </if>
      <if test="customerType != null">
        customer_type,
      </if>
      <if test="version != null">
        version,
      </if>
      <if test="cmsCcCreator != null">
        cms_cc_creator,
      </if>
      <if test="cmsCcUpdator != null">
        cms_cc_updator,
      </if>
      <if test="cmsCcCreatTime != null">
        cms_cc_creat_time,
      </if>
      <if test="cmsCcUpdateTime != null">
        cms_cc_update_time,
      </if>
      <if test="deleteSign != null">
        delete_sign,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="cmsCcId != null">
        #{cmsCcId,jdbcType=INTEGER},
      </if>
      <if test="cmsCcRid != null">
        #{cmsCcRid,jdbcType=INTEGER},
      </if>
      <if test="balance != null">
        #{balance,jdbcType=REAL},
      </if>
      <if test="overdraft != null">
        #{overdraft,jdbcType=REAL},
      </if>
      <if test="cmsCcPlanId != null">
        #{cmsCcPlanId,jdbcType=INTEGER},
      </if>
      <if test="cmsCcRankId != null">
        #{cmsCcRankId,jdbcType=INTEGER},
      </if>
      <if test="customerType != null">
        #{customerType,jdbcType=VARCHAR},
      </if>
      <if test="version != null">
        #{version,jdbcType=INTEGER},
      </if>
      <if test="cmsCcCreator != null">
        #{cmsCcCreator,jdbcType=INTEGER},
      </if>
      <if test="cmsCcUpdator != null">
        #{cmsCcUpdator,jdbcType=INTEGER},
      </if>
      <if test="cmsCcCreatTime != null">
        #{cmsCcCreatTime,jdbcType=TIMESTAMP},
      </if>
      <if test="cmsCcUpdateTime != null">
        #{cmsCcUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteSign != null">
        #{deleteSign,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cms.pojo.CmsCustomerCost">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update cms_customer_cost
    <set>
      <if test="cmsCcRid != null">
        cms_cc_rid = #{cmsCcRid,jdbcType=INTEGER},
      </if>
      <if test="balance != null">
        balance = #{balance,jdbcType=REAL},
      </if>
      <if test="overdraft != null">
        overdraft = #{overdraft,jdbcType=REAL},
      </if>
      <if test="cmsCcPlanId != null">
        cms_cc_plan_id = #{cmsCcPlanId,jdbcType=INTEGER},
      </if>
      <if test="cmsCcRankId != null">
        cms_cc_rank_id = #{cmsCcRankId,jdbcType=INTEGER},
      </if>
      <if test="customerType != null">
        customer_type = #{customerType,jdbcType=VARCHAR},
      </if>
      <if test="version != null">
        version = #{version,jdbcType=INTEGER}+1,
      </if>
      <if test="cmsCcCreator != null">
        cms_cc_creator = #{cmsCcCreator,jdbcType=INTEGER},
      </if>
      <if test="cmsCcUpdator != null">
        cms_cc_updator = #{cmsCcUpdator,jdbcType=INTEGER},
      </if>
      <if test="cmsCcCreatTime != null">
        cms_cc_creat_time = #{cmsCcCreatTime,jdbcType=TIMESTAMP},
      </if>
      <if test="cmsCcUpdateTime != null">
        cms_cc_update_time = #{cmsCcUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteSign != null">
        delete_sign = #{deleteSign,jdbcType=VARCHAR},
      </if>
    </set>
    where cms_cc_id = #{cmsCcId,jdbcType=INTEGER} and version = #{version,jdbcType=INTEGER}+1
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cms.pojo.CmsCustomerCost">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update cms_customer_cost
    set cms_cc_rid = #{cmsCcRid,jdbcType=INTEGER},
      balance = #{balance,jdbcType=REAL},
      overdraft = #{overdraft,jdbcType=REAL},
      cms_cc_plan_id = #{cmsCcPlanId,jdbcType=INTEGER},
      cms_cc_rank_id = #{cmsCcRankId,jdbcType=INTEGER},
      customer_type = #{customerType,jdbcType=VARCHAR},
      version = #{version,jdbcType=INTEGER}+1,
      cms_cc_creator = #{cmsCcCreator,jdbcType=INTEGER},
      cms_cc_updator = #{cmsCcUpdator,jdbcType=INTEGER},
      cms_cc_creat_time = #{cmsCcCreatTime,jdbcType=TIMESTAMP},
      cms_cc_update_time = #{cmsCcUpdateTime,jdbcType=TIMESTAMP},
      delete_sign = #{deleteSign,jdbcType=VARCHAR}
    where cms_cc_id = #{cmsCcId,jdbcType=INTEGER} and version = #{version,jdbcType=INTEGER}
  </update>
  <update id="updateBybalance" parameterType="com.cms.pojo.CmsCustomerCost">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update cms_customer_cost,cms_plan
    set cms_customer_cost.balance =cms_customer_cost.balance-cms_plan.plan_money
    where cms_customer_cost.cms_cc_plan_id = cms_plan.cms_plan_id
  </update>
  <select id="getBalance" parameterType="java.lang.Integer" resultType="java.lang.Float">
    select 
    balance
    from cms_customer_cost
    where cms_cc_id = #{cmsCcId,jdbcType=INTEGER}
  </select>
  <select id="getByPhone" parameterType="java.lang.String" resultMap="BaseResultMap">
  	select cms_cc_id, cms_cc_rid, balance, overdraft, cms_cc_plan_id, cms_cc_rank_id, customer_type, 
    	ccc.version, cms_cc_creator, cms_cc_updator, cms_cc_creat_time, cms_cc_update_time, ccc.delete_sign
    from cms_customer_cost ccc, cms_customer_auth cca
    where ccc.cms_cc_rid = cca.cms_auth_id and
    	  cca.phone_num = #{phone }
  </select>
  <update id="editBalanceById" parameterType="com.cms.pojo.CmsCustomerCost">
  	update cms_customer_cost
  	set balance = #{balance },
      version = #{version } + 1,
      cms_cc_updator = #{cmsCcUpdator },
      cms_cc_update_time = #{cmsCcUpdateTime }
  	where cms_cc_id = #{cmsCcId }
  		and version = #{version }
  </update>
  
</mapper>